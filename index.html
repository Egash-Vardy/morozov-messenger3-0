<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <title>MOROZOV ULTRA | OVERLORD</title>

    <style id="mu-core-styles">
        /* [ –ú–û–î–£–õ–¨ 1: –ì–ï–û–ú–ï–¢–†–ò–Ø –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï ]
           –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–º–∞–º–∏. –ó–¥–µ—Å—å –ø—Ä–æ–ø–∏—Å–∞–Ω—ã –≤—Å–µ —Ü–≤–µ—Ç–æ–≤—ã–µ —Å—Ö–µ–º—ã.
        */
        :root {
            --bg-deep: #000000;
            --bg-panel: #0a0a0b;
            --bg-card: #121214;
            --bg-input: #050505;
            --accent: #007aff;
            --accent-glow: rgba(0, 122, 255, 0.4);
            --text-main: #ffffff;
            --text-dim: #8e8e93;
            --danger: #ff3b30;
            --success: #34c759;
            --border: #1c1c1e;
            --radius-main: 24px;
            --font-main: 'SF Pro Display', -apple-system, system-ui, sans-serif;
        }

        /* –¢–ï–ú–ê: –ù–ï–û–ù–û–í–´–ô –ì–û–†–û–î */
        [data-theme="neon"] {
            --bg-deep: #020408;
            --bg-panel: #050a14;
            --bg-card: #0a1628;
            --accent: #00d2ff;
            --accent-glow: rgba(0, 210, 255, 0.5);
            --border: #00d2ff33;
        }

        /* –¢–ï–ú–ê: –ú–ê–¢–†–ò–¶–ê (–•–ê–ö–ï–†) */
        [data-theme="matrix"] {
            --bg-deep: #000a00;
            --bg-panel: #001500;
            --bg-card: #002000;
            --accent: #00ff41;
            --accent-glow: rgba(0, 255, 65, 0.4);
            --text-main: #00ff41;
            --text-dim: #008f11;
            --border: #00ff4144;
        }

        /* –¢–ï–ú–ê: –ö–†–û–í–ê–í–´–ô –†–ê–°–°–í–ï–¢ */
        [data-theme="blood"] {
            --bg-deep: #0a0101;
            --bg-panel: #1a0202;
            --bg-card: #2a0505;
            --accent: #ff3b30;
            --accent-glow: rgba(255, 59, 48, 0.5);
            --border: #ff3b3044;
        }

        /* –¢–ï–ú–ê: –ó–û–õ–û–¢–û –ú–û–ù–û–õ–ò–¢–ê */
        [data-theme="gold"] {
            --bg-deep: #0a0800;
            --bg-panel: #1a1500;
            --bg-card: #2a2200;
            --accent: #ffcc00;
            --accent-glow: rgba(255, 204, 0, 0.4);
            --border: #ffcc0044;
        }

        /* [ –ú–û–î–£–õ–¨ 2: –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê ] */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: var(--font-main); -webkit-font-smoothing: antialiased; }
        
        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .mu-monolith {
            position: relative;
            flex: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* [ –ú–û–î–£–õ–¨ 3: –°–ò–°–¢–ï–ú–ê –≠–ö–†–ê–ù–û–í ] */
        .mu-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: none;
            flex-direction: column;
            background: var(--bg-deep);
            z-index: 10;
        }

        .mu-screen.active {
            display: flex;
            animation: mu-zoom-in 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        @keyframes mu-zoom-in {
            from { opacity: 0; transform: scale(1.1); filter: blur(15px); }
            to { opacity: 1; transform: scale(1); filter: blur(0); }
        }

        /* [ –ú–û–î–£–õ–¨ 4: –ö–û–ú–ü–û–ù–ï–ù–¢–´ –ò–ù–¢–ï–†–§–ï–ô–°–ê ] */
        .mu-header {
            height: 100px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .mu-logo-text {
            font-size: 30px;
            font-weight: 900;
            font-style: italic;
            letter-spacing: -1.5px;
            text-transform: uppercase;
        }

        .mu-logo-text span {
            color: var(--accent);
            text-shadow: 0 0 20px var(--accent-glow);
        }

        .mu-scroll-container {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            scroll-behavior: smooth;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –¥—Ä—É–≥–∞ / –£–∑–ª–∞ */
        .mu-node-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-main);
            padding: 25px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
            cursor: pointer;
            transition: 0.3s;
            position: relative;
            overflow: hidden;
        }

        .mu-node-card:hover {
            transform: translateY(-3px) scale(1.02);
            border-color: var(--accent);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }

        .mu-avatar-large {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--accent), #000);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 900;
            color: #fff;
            border: 2px solid var(--border);
        }

        /* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
        .mu-input-box {
            width: 100%;
            background: var(--bg-input);
            border: 1px solid var(--border);
            padding: 20px 25px;
            border-radius: 18px;
            color: #fff;
            font-size: 16px;
            margin-bottom: 20px;
            outline: none;
            transition: 0.3s;
        }

        .mu-input-box:focus {
            border-color: var(--accent);
            box-shadow: 0 0 20px var(--accent-glow);
        }

        .mu-btn-main {
            width: 100%;
            padding: 22px;
            background: var(--accent);
            border: none;
            border-radius: 18px;
            color: #000;
            font-weight: 900;
            font-size: 18px;
            text-transform: uppercase;
            cursor: pointer;
            transition: 0.3s;
        }

        .mu-btn-main:hover {
            filter: brightness(1.2);
            box-shadow: 0 0 30px var(--accent-glow);
        }

        /* [ –ú–û–î–£–õ–¨ 5: –ß–ê–¢ ] */
        .mu-chat-feed {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .mu-bubble {
            max-width: 70%;
            padding: 18px 25px;
            border-radius: 25px;
            font-size: 16px;
            line-height: 1.6;
            position: relative;
            animation: bubble-up 0.4s ease;
        }

        @keyframes bubble-up { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .mu-bubble.me {
            align-self: flex-end;
            background: var(--accent);
            color: #000;
            border-bottom-right-radius: 5px;
            font-weight: 600;
        }

        .mu-bubble.peer {
            align-self: flex-start;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-bottom-left-radius: 5px;
        }

        .mu-chat-footer {
            padding: 25px 25px 50px 25px;
            background: var(--bg-panel);
            border-top: 1px solid var(--border);
            display: flex;
            gap: 15px;
        }

        /* [ –ú–û–î–£–õ–¨ 6: –ù–ê–í–ò–ì–ê–¶–ò–Ø ] */
        .mu-nav-bar {
            height: 100px;
            background: var(--bg-panel);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding-bottom: 25px;
        }

        .mu-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: var(--text-dim);
            cursor: pointer;
            transition: 0.3s;
            font-weight: 800;
            font-size: 11px;
            text-transform: uppercase;
        }

        .mu-nav-item.active {
            color: var(--accent);
            transform: translateY(-5px);
        }

        .mu-nav-icon { font-size: 24px; }

        /* [ –ú–û–î–£–õ–¨ 7: –°–ï–¢–ö–ê –¢–ï–ú ] */
        .mu-theme-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .mu-theme-card {
            padding: 20px;
            border-radius: 15px;
            border: 2px solid var(--border);
            text-align: center;
            font-weight: 900;
            cursor: pointer;
        }

        .mu-theme-card.active { border-color: var(--accent); background: var(--accent-glow); }

        /* [ –ú–û–î–£–õ–¨ 8: –°–ò–°–¢–ï–ú–ù–´–ï –õ–û–ì–ò (–ö–û–ù–°–û–õ–¨) ] */
        .mu-sys-logs {
            background: #000;
            border: 1px solid #1a1a1a;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            color: var(--success);
            height: 120px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body data-theme="default">

    <div class="mu-monolith">
        
        <div id="scr-auth" class="mu-screen active">
            <div style="flex: 1; display: flex; flex-direction: column; justify-content: center; padding: 50px;">
                <div class="mu-logo-text" style="font-size: 50px; text-align: center; margin-bottom: 10px;">MOROZOV <span>ULTRA</span></div>
                <p style="text-align: center; color: var(--text-dim); letter-spacing: 5px; font-size: 10px; margin-bottom: 50px;">OVERLORD EDITION V10.0</p>
                
                <label style="font-size: 10px; color: var(--text-dim); margin-left: 10px; margin-bottom: 5px;">–ò–î–ï–ù–¢–ò–§–ò–ö–ê–¢–û–†</label>
                <input type="email" id="inp-email" class="mu-input-box" value="egorkamorozoff2014@gmail.com">
                
                <label style="font-size: 10px; color: var(--text-dim); margin-left: 10px; margin-bottom: 5px;">–ö–û–î –î–û–°–¢–£–ü–ê</label>
                <input type="password" id="inp-pass" class="mu-input-box" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                
                <label style="font-size: 10px; color: var(--text-dim); margin-left: 10px; margin-bottom: 5px;">–ü–û–ó–´–í–ù–û–ô (–î–õ–Ø –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò)</label>
                <input type="text" id="inp-nick" class="mu-input-box" placeholder="NICKNAME">
                
                <button class="mu-btn-main" onclick="Core.initAuth()">–ü–û–î–ö–õ–Æ–ß–ò–¢–¨–°–Ø –ö –ú–û–ù–û–õ–ò–¢–£</button>
            </div>
        </div>

        <div id="scr-hub" class="mu-screen">
            <div class="mu-header">
                <div class="mu-logo-text" style="font-size: 24px;">ULTRA <span>HUB</span></div>
                <button onclick="Core.addFriend()" style="background:var(--accent); border:none; padding:10px 20px; border-radius:12px; font-weight:900; color:#000; cursor:pointer;">+ –î–û–ë–ê–í–ò–¢–¨ –í –î–†</button>
            </div>
            
            <div id="friends-list" class="mu-scroll-container">
                </div>

            <div class="mu-nav-bar">
                <div class="mu-nav-item active" onclick="Core.screen('scr-hub')">
                    <span class="mu-nav-icon">üí¨</span><span>–°–í–Ø–ó–¨</span>
                </div>
                <div class="mu-nav-item" onclick="Core.screen('scr-settings')">
                    <span class="mu-nav-icon">üõ†Ô∏è</span><span>–Ø–î–†–û</span>
                </div>
            </div>
        </div>

        <div id="scr-chat" class="mu-screen">
            <div class="mu-header">
                <button onclick="Core.screen('scr-hub')" style="background:none; border:none; color:var(--text-main); font-size:30px; cursor:pointer;">‚Üê</button>
                <div id="chat-target-name" class="mu-logo-text" style="font-size: 20px;">NODE</div>
                <div style="width: 40px;"></div>
            </div>
            
            <div id="chat-feed" class="mu-chat-feed"></div>
            
            <div class="mu-chat-footer">
                <input type="text" id="msg-input" class="mu-input-box" style="margin:0;" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–∏–≥–Ω–∞–ª...">
                <button class="mu-btn-main" style="width: 100px; padding: 0;" onclick="Core.sendMsg()">üì°</button>
            </div>
        </div>

        <div id="scr-settings" class="mu-screen">
            <div class="mu-header"><div class="mu-logo-text">–ö–û–ù–¢–†–û–õ–¨ <span>–Ø–î–†–ê</span></div></div>
            
            <div class="mu-scroll-container">
                <h3 style="font-size: 12px; color: var(--text-dim); text-transform: uppercase; margin-bottom: 15px;">–°–ú–ï–ù–ò–¢–¨ –í–ò–ó–£–ê–õ–¨–ù–£–Æ –¢–ï–ú–£</h3>
                <div class="mu-theme-selector">
                    <div class="mu-theme-card" style="background:#000; color:#007aff;" onclick="Core.setTheme('default')">–ü–û–õ–£–ù–û–ß–¨</div>
                    <div class="mu-theme-card" style="background:#050a14; color:#00d2ff;" onclick="Core.setTheme('neon')">–ù–ï–û–ù</div>
                    <div class="mu-theme-card" style="background:#001500; color:#00ff41;" onclick="Core.setTheme('matrix')">–ú–ê–¢–†–ò–¶–ê</div>
                    <div class="mu-theme-card" style="background:#1a0202; color:#ff3b30;" onclick="Core.setTheme('blood')">–ö–†–û–í–¨</div>
                    <div class="mu-theme-card" style="background:#1a1500; color:#ffcc00;" onclick="Core.setTheme('gold')">–ó–û–õ–û–¢–û</div>
                </div>

                <div style="margin-top: 40px;">
                    <h3 style="font-size: 12px; color: var(--text-dim); text-transform: uppercase; margin-bottom: 15px;">–í–ê–® –ü–†–û–§–ò–õ–¨</h3>
                    <div class="mu-node-card" style="cursor: default;">
                        <div class="mu-avatar-large" id="my-avatar">?</div>
                        <div>
                            <div id="my-name" style="font-weight: 900; font-size: 20px;">USER_NICK</div>
                            <div id="my-email" style="font-size: 12px; color: var(--text-dim);">user@email.com</div>
                        </div>
                    </div>
                </div>

                <div class="mu-sys-logs" id="sys-logs">
                    > SYSTEM_STARTUP: OK<br>
                    > FIREBASE_LINK: ESTABLISHED<br>
                    > MOROZOV_ULTRA_V10: READY...
                </div>

                <button class="mu-btn-main" style="background: var(--danger); color: #fff; margin-top: 30px;" onclick="Core.logout()">–£–ù–ò–ß–¢–û–ñ–ò–¢–¨ –°–ï–°–°–ò–Æ</button>
            </div>

            <div class="mu-nav-bar">
                <div class="mu-nav-item" onclick="Core.screen('scr-hub')">
                    <span class="mu-nav-icon">üí¨</span><span>–°–í–Ø–ó–¨</span>
                </div>
                <div class="mu-nav-item active" onclick="Core.screen('scr-settings')">
                    <span class="mu-nav-icon">üõ†Ô∏è</span><span>–Ø–î–†–û</span>
                </div>
            </div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, get, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // –ì–ò–ì–ê-–ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
        const firebaseConfig = {
            apiKey: "AIzaSyDutfZZER58asyHr68zWlCx7B5k1adFhIk",
            authDomain: "morozov-ultra.firebaseapp.com",
            databaseURL: "https://morozov-ultra-default-rtdb.firebaseio.com",
            projectId: "morozov-ultra",
            storageBucket: "morozov-ultra.appspot.com",
            appId: "1:255345933856:web:5b8d1b93696f36eb5d4645"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        window.STATE = { me: null, peer: null, room: null };

        window.Core = {
            // –õ–û–ì–ï–†
            log: (msg) => {
                const l = document.getElementById('sys-logs');
                l.innerHTML += `<br>> ${msg}`;
                l.scrollTop = l.scrollHeight;
            },

            // –ù–ê–í–ò–ì–ê–¶–ò–Ø
            screen: (id) => {
                document.querySelectorAll('.mu-screen').forEach(s => s.classList.remove('active'));
                document.getElementById(id).classList.add('active');
            },

            // –¢–ï–ú–´
            setTheme: (t) => {
                document.body.setAttribute('data-theme', t);
                Core.log(`THEME_CHANGED: ${t.toUpperCase()}`);
            },

            // –í–•–û–î
            initAuth: async () => {
                const e = document.getElementById('inp-email').value;
                const p = document.getElementById('inp-pass').value;
                const n = document.getElementById('inp-nick').value;
                Core.log("AUTH_REQUEST: SENDING...");
                try {
                    await signInWithEmailAndPassword(auth, e, p);
                } catch (err) {
                    if(n) {
                        Core.log("NEW_NODE_DETECTION: REGISTERING...");
                        const r = await createUserWithEmailAndPassword(auth, e, p);
                        const d = { id: n, uid: r.user.uid, email: e, ts: Date.now() };
                        await set(ref(db, `mu_v100/nodes/${r.user.uid}`), d);
                        await set(ref(db, `mu_v100/map/${n}`), r.user.uid);
                    } else { alert("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞!"); }
                }
            },

            // –î–û–ë–ê–í–ò–¢–¨ –í –î–†
            addFriend: () => {
                const name = prompt("–í–í–ï–î–ò–¢–ï –ù–ò–ö –î–†–£–ì–ê:");
                if(!name) return;
                Core.log(`FRIEND_SEARCH: ${name}`);
                get(ref(db, `mu_v100/map/${name}`)).then(s => {
                    if(s.exists()) {
                        const targetUid = s.val();
                        const up = {};
                        up[`mu_v100/mesh/${STATE.me.uid}/${targetUid}`] = { id: name, uid: targetUid };
                        up[`mu_v100/mesh/${targetUid}/${STATE.me.uid}`] = { id: STATE.me.id, uid: STATE.me.uid };
                        update(ref(db), up);
                        Core.log("FRIEND_ADDED: SUCCESS");
                    } else { alert("–£–∑–µ–ª –Ω–µ –Ω–∞–π–¥–µ–Ω!"); }
                });
            },

            // –ß–ê–¢
            openChat: (p) => {
                STATE.peer = p;
                STATE.room = [STATE.me.uid, p.uid].sort().join("___");
                document.getElementById('chat-target-name').innerText = p.id.toUpperCase();
                Core.screen('scr-chat');
                Core.log(`ENCRYPTED_CHANNEL: ${STATE.room}`);

                onValue(ref(db, `mu_v100/msgs/${STATE.room}`), snap => {
                    const f = document.getElementById('chat-feed');
                    f.innerHTML = "";
                    snap.forEach(m => {
                        const d = m.val();
                        const b = document.createElement('div');
                        b.className = `mu-bubble ${d.sid === STATE.me.uid ? 'me' : 'peer'}`;
                        b.innerText = d.txt;
                        f.appendChild(b);
                    });
                    f.scrollTop = f.scrollHeight;
                });
            },

            sendMsg: () => {
                const i = document.getElementById('msg-input');
                if(!i.value) return;
                push(ref(db, `mu_v100/msgs/${STATE.room}`), { sid: STATE.me.uid, txt: i.value, ts: Date.now() });
                i.value = "";
            },

            logout: () => { if(confirm("–†–ê–ó–û–†–í–ê–¢–¨ –°–í–Ø–ó–¨?")) signOut(auth).then(() => location.reload()); }
        };

        // –ù–ê–ë–õ–Æ–î–ê–¢–ï–õ–¨
        onAuthStateChanged(auth, u => {
            if(u) {
                onValue(ref(db, `mu_v100/nodes/${u.uid}`), s => {
                    STATE.me = s.val();
                    if(STATE.me) {
                        document.getElementById('my-name').innerText = STATE.me.id.toUpperCase();
                        document.getElementById('my-email').innerText = STATE.me.email;
                        document.getElementById('my-avatar').innerText = STATE.me.id[0].toUpperCase();
                        Core.screen('scr-hub');
                        Core.log(`WELCOME_BACK: ${STATE.me.id}`);

                        onValue(ref(db, `mu_v100/mesh/${u.uid}`), mSnap => {
                            const l = document.getElementById('friends-list');
                            l.innerHTML = "";
                            mSnap.forEach(f => {
                                const fd = f.val();
                                const c = document.createElement('div');
                                c.className = "mu-node-card";
                                c.innerHTML = `<div class="mu-avatar-large">${fd.id[0].toUpperCase()}</div><div><div style="font-weight:900; font-size:18px;">${fd.id}</div><div style="font-size:11px;color:var(--text-dim);">–û–ù–õ–ê–ô–ù</div></div>`;
                                c.onclick = () => Core.openChat(fd);
                                l.appendChild(c);
                            });
                        });
                    }
                });
            } else { Core.screen('scr-auth'); }
        });
    </script>
</body>
</html>
