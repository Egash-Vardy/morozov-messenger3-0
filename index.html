<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <title>MOROZOV ULTRA | MONOLITH</title>

    <style>
        /* [ –ú–û–î–£–õ–¨ 1: –ì–õ–û–ë–ê–õ–¨–ù–´–ô –î–í–ò–ñ–û–ö –ü–ï–†–ï–ú–ï–ù–ù–´–• ]
           –ó–¥–µ—Å—å –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –≤—Å–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤–∏–∑—É–∞–ª—å–Ω–æ–π –æ–±–æ–ª–æ—á–∫–∏.
        */
        :root {
            --m-core-bg: #000000;
            --m-core-surface: #0a0a0b;
            --m-core-panel: #111112;
            --m-core-card: #18181b;
            --m-core-accent: #007aff;
            --m-core-accent-rgb: 0, 122, 255;
            --m-core-accent-active: #0051d9;
            --m-core-text-main: #ffffff;
            --m-core-text-secondary: #8e8e93;
            --m-core-text-muted: #48484a;
            --m-core-border: #242426;
            --m-core-input-bg: #050505;
            --m-core-shadow-sm: 0 2px 8px rgba(0,0,0,0.5);
            --m-core-shadow-md: 0 12px 24px rgba(0,0,0,0.7);
            --m-core-shadow-lg: 0 20px 40px rgba(0,0,0,0.9);
            --m-core-glow: 0 0 20px rgba(0, 122, 255, 0.4);
            --m-core-radius-inner: 12px;
            --m-core-radius-outer: 24px;
            --m-core-radius-circle: 50%;
            --m-core-anim-fast: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --m-core-anim-mid: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            --m-core-anim-slow: 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            --m-core-font: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", sans-serif;
        }

        /* [ –ú–û–î–£–õ–¨ 2: WHITE PLATINUM EDITION (EXTENDED) ]
           –ü–æ–ª–Ω–∞—è –∏–Ω–≤–µ—Ä—Å–∏—è —Ü–≤–µ—Ç–æ–≤–æ–π –º–∞—Ç—Ä–∏—Ü—ã –¥–ª—è —Å–≤–µ—Ç–ª–æ–≥–æ —Ä–µ–∂–∏–º–∞.
        */
        [data-theme="white"] {
            --m-core-bg: #f2f2f7;
            --m-core-surface: #ffffff;
            --m-core-panel: #fcfcfd;
            --m-core-card: #ffffff;
            --m-core-accent: #007aff;
            --m-core-accent-active: #0051d9;
            --m-core-text-main: #1d1d1f;
            --m-core-text-secondary: #86868b;
            --m-core-text-muted: #aeaeb2;
            --m-core-border: #d1d1d6;
            --m-core-input-bg: #e5e5ea;
            --m-core-shadow-md: 0 12px 24px rgba(0,0,0,0.05);
            --m-core-shadow-lg: 0 20px 40px rgba(0,0,0,0.08);
            --m-core-glow: 0 0 20px rgba(0, 122, 255, 0.2);
        }

        /* [ –ú–û–î–£–õ–¨ 3: –°–ë–†–û–° –ò –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–†–ê–í–ò–õ–ê ]
        */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--m-core-bg);
            color: var(--m-core-text-main);
            font-family: var(--m-core-font);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            transition: background 0.6s var(--m-core-anim-mid);
        }

        input, textarea, button {
            font-family: inherit;
            user-select: text;
        }

        /* [ –ú–û–î–£–õ–¨ 4: –°–ö–†–û–õ–õ–ë–ê–†–´ (CUSTOM DESIGN) ]
        */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { 
            background: var(--m-core-accent); 
            border-radius: 10px; 
            box-shadow: 0 0 5px var(--m-core-glow);
        }

        /* [ –ú–û–î–£–õ–¨ 5: –°–ò–°–¢–ï–ú–ê –≠–ö–†–ê–ù–û–í (VIEWPORT CONTROLLER) ]
        */
        .mu-viewport {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            background: var(--m-core-bg);
            z-index: 10;
            overflow: hidden;
        }

        .mu-viewport.active {
            display: flex;
            animation: viewportFadeIn 0.5s var(--m-core-anim-mid);
        }

        @keyframes viewportFadeIn {
            from { opacity: 0; transform: scale(1.05) translateY(20px); filter: blur(15px); }
            to { opacity: 1; transform: scale(1) translateY(0); filter: blur(0); }
        }

        /* [ –ú–û–î–£–õ–¨ 6: –®–ê–ü–ö–ê (ULTRA HEADER V22) ]
        */
        .mu-header {
            height: 120px;
            background: var(--m-core-surface);
            border-bottom: 1px solid var(--m-core-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 40px 0 40px;
            box-shadow: var(--m-core-shadow-md);
            z-index: 100;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .mu-logo-container {
            display: flex;
            flex-direction: column;
        }

        .mu-logo-main {
            font-size: 32px;
            font-weight: 900;
            letter-spacing: -2px;
            text-transform: uppercase;
        }

        .mu-logo-main span {
            color: var(--m-core-accent);
            text-shadow: 0 0 15px var(--m-core-glow);
        }

        .mu-logo-sub {
            font-size: 10px;
            color: var(--m-core-text-secondary);
            letter-spacing: 5px;
            text-transform: uppercase;
            font-weight: 800;
        }

        .mu-status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(var(--m-core-accent-rgb), 0.1);
            padding: 10px 20px;
            border-radius: 40px;
            border: 1px solid var(--m-core-accent);
        }

        .mu-status-dot {
            width: 8px;
            height: 8px;
            background: var(--m-core-accent);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--m-core-accent);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* [ –ú–û–î–£–õ–¨ 7: –°–ò–°–¢–ï–ú–ê –ö–ù–û–ü–û–ö –ò –ü–û–õ–ï–ô –í–í–û–î–ê ]
        */
        .mu-scanner-area {
            padding: 30px 40px;
            background: var(--m-core-panel);
            border-bottom: 1px solid var(--m-core-border);
        }

        .mu-input-composite {
            display: flex;
            gap: 15px;
            background: var(--m-core-input-bg);
            padding: 8px;
            border-radius: 20px;
            border: 2px solid var(--m-core-border);
            transition: var(--m-core-anim-mid);
            box-shadow: var(--m-core-shadow-sm);
        }

        .mu-input-composite:focus-within {
            border-color: var(--m-core-accent);
            box-shadow: var(--m-core-glow);
            transform: translateY(-2px);
        }

        .mu-native-field {
            flex: 1;
            background: transparent;
            border: none;
            padding: 15px 25px;
            color: var(--m-core-text-main);
            font-size: 18px;
            outline: none;
            font-weight: 600;
        }

        .mu-native-field::placeholder {
            color: var(--m-core-text-muted);
        }

        .mu-btn-action {
            background: var(--m-core-accent);
            color: #ffffff;
            border: none;
            padding: 0 35px;
            border-radius: 14px;
            font-weight: 900;
            font-size: 14px;
            cursor: pointer;
            text-transform: uppercase;
            transition: var(--m-core-anim-fast);
            letter-spacing: 1px;
            box-shadow: 0 4px 12px rgba(var(--m-core-accent-rgb), 0.3);
        }

        .mu-btn-action:hover {
            filter: brightness(1.2);
            transform: translateY(-1px);
        }

        .mu-btn-action:active {
            transform: scale(0.92);
        }

        /* [ –ú–û–î–£–õ–¨ 8: –°–ü–ò–°–û–ö –£–ó–õ–û–í (NODES LIST) ]
        */
        .mu-scrollable-zone {
            flex: 1;
            overflow-y: auto;
            padding: 30px 40px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: var(--m-core-bg);
        }

        .mu-node-card {
            background: var(--m-core-card);
            border: 1px solid var(--m-core-border);
            border-radius: 30px;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            cursor: pointer;
            transition: var(--m-core-anim-mid);
            position: relative;
            animation: cardSlideIn 0.5s var(--m-core-anim-mid) both;
        }

        @keyframes cardSlideIn {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .mu-node-card:hover {
            transform: scale(1.02) translateX(10px);
            border-color: var(--m-core-accent);
            background: var(--m-core-panel);
            box-shadow: var(--m-core-shadow-md);
        }

        .mu-node-avatar {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--m-core-accent), var(--m-core-accent-active));
            border-radius: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 900;
            font-size: 28px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            text-transform: uppercase;
        }

        .mu-node-content {
            flex: 1;
        }

        .mu-node-name {
            font-size: 22px;
            font-weight: 900;
            margin-bottom: 5px;
            color: var(--m-core-text-main);
        }

        .mu-node-status {
            font-size: 11px;
            color: var(--m-core-accent);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 800;
        }

        /* [ –ú–û–î–£–õ–¨ 9: –ß–ê–¢-–¢–ï–†–ú–ò–ù–ê–õ (CHAT INTERFACE) ]
        */
        .mu-chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 40px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            background-image: 
                radial-gradient(circle at 2px 2px, var(--m-core-border) 1px, transparent 0);
            background-size: 40px 40px;
        }

        .mu-msg-bubble {
            max-width: 75%;
            padding: 22px 28px;
            border-radius: 30px;
            font-size: 17px;
            line-height: 1.6;
            position: relative;
            animation: msgPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: var(--m-core-shadow-sm);
        }

        @keyframes msgPop {
            from { opacity: 0; transform: scale(0.8) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .mu-msg-bubble.sent {
            align-self: flex-end;
            background: var(--m-core-accent);
            color: #ffffff;
            border-bottom-right-radius: 5px;
            box-shadow: 0 10px 30px rgba(var(--m-core-accent-rgb), 0.4);
        }

        .mu-msg-bubble.received {
            align-self: flex-start;
            background: var(--m-core-panel);
            color: var(--m-core-text-main);
            border: 1px solid var(--m-core-border);
            border-bottom-left-radius: 5px;
        }

        /* [ –ú–û–î–£–õ–¨ 10: –ù–ò–ñ–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ –ù–ê–í–ò–ì–ê–¶–ò–ò ]
        */
        .mu-bottom-nav {
            height: 110px;
            background: var(--m-core-surface);
            border-top: 1px solid var(--m-core-border);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding-bottom: 35px;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.5);
        }

        .mu-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: var(--m-core-text-secondary);
            cursor: pointer;
            transition: var(--m-core-anim-fast);
            flex: 1;
        }

        .mu-nav-item.active {
            color: var(--m-core-accent);
        }

        .mu-nav-item i {
            font-style: normal;
            font-size: 28px;
            filter: drop-shadow(0 0 5px transparent);
            transition: 0.3s;
        }

        .mu-nav-item.active i {
            filter: drop-shadow(0 0 8px var(--m-core-glow));
            transform: translateY(-5px);
        }

        .mu-nav-item span {
            font-size: 10px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* [ –ú–û–î–£–õ–¨ 11: –¶–ï–ù–¢–† –£–í–ï–î–û–ú–õ–ï–ù–ò–ô (TOAST SYSTEM) ]
        */
        .mu-toast-wrapper {
            position: fixed;
            top: -120px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--m-core-accent);
            color: #ffffff;
            padding: 22px 60px;
            border-radius: 60px;
            font-weight: 900;
            font-size: 14px;
            z-index: 9999;
            transition: 0.7s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            white-space: nowrap;
        }

        .mu-toast-wrapper.visible {
            top: 50px;
        }

        /* [ –ú–û–î–£–õ–¨ 12: CORE GRID (–ù–ê–°–¢–†–û–ô–ö–ò) ]
        */
        .mu-grid-layout {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-top: 30px;
        }

        .mu-grid-item {
            background: var(--m-core-card);
            border: 2px solid var(--m-core-border);
            padding: 40px 20px;
            border-radius: 35px;
            text-align: center;
            cursor: pointer;
            transition: var(--m-core-anim-mid);
        }

        .mu-grid-item:hover {
            border-color: var(--m-core-accent);
            background: var(--m-core-panel);
            transform: translateY(-5px);
        }

        .mu-grid-item.active {
            background: var(--m-core-accent);
            color: #fff;
            border-color: #fff;
            box-shadow: 0 15px 30px rgba(var(--m-core-accent-rgb), 0.4);
        }

        .mu-grid-item i {
            font-size: 40px;
            display: block;
            margin-bottom: 15px;
        }

        /* [ –ú–û–î–£–õ–¨ 13: –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø (LAYOUT) ]
        */
        .mu-auth-center {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 60px;
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
        }

        .mu-auth-title {
            font-size: 60px;
            font-weight: 900;
            text-align: center;
            margin-bottom: 10px;
            letter-spacing: -3px;
        }

        .mu-auth-title span {
            color: var(--m-core-accent);
        }

        .mu-auth-subtitle {
            text-align: center;
            color: var(--m-core-text-secondary);
            letter-spacing: 12px;
            font-size: 13px;
            margin-bottom: 80px;
            text-transform: uppercase;
            font-weight: 800;
        }

        .mu-auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

    </style>
</head>
<body data-theme="dark">

    <div id="mu-global-toast" class="mu-toast-wrapper">System Matrix Online</div>

    <div id="mu-application-root">

        <section id="screen-auth" class="mu-viewport active">
            <div class="mu-auth-center">
                <div class="mu-auth-title">MOROZOV <span>ULTRA</span></div>
                <div class="mu-auth-subtitle">ABSOLUTE MONOLITH</div>
                
                <div class="mu-auth-form">
                    <div class="mu-input-composite">
                        <input type="email" id="f-auth-email" class="mu-native-field" value="egorkamorozoff2014@gmail.com">
                    </div>
                    <div class="mu-input-composite">
                        <input type="password" id="f-auth-pass" class="mu-native-field" placeholder="–°–ï–ö–†–ï–¢–ù–´–ô –ö–û–î">
                    </div>
                    <div class="mu-input-composite">
                        <input type="text" id="f-auth-nick" class="mu-native-field" placeholder="–ü–û–ó–´–í–ù–û–ô (–ù–ò–ö–ù–ï–ô–ú)">
                    </div>
                    <button class="mu-btn-action" style="height: 85px; font-size: 22px; border-radius: 25px; margin-top: 30px;" onclick="Engine.processAuth()">
                        –ü–û–î–ö–õ–Æ–ß–ò–¢–¨–°–Ø –ö –°–ï–¢–ò
                    </button>
                    <div id="auth-status-log" style="text-align: center; color: var(--m-core-accent); font-size: 10px; font-weight: 900; margin-top: 20px; text-transform: uppercase;">
                        Status: Waiting for Command...
                    </div>
                </div>
            </div>
        </section>

        <section id="screen-hub" class="mu-viewport">
            <header class="mu-header">
                <div class="mu-logo-container">
                    <div class="mu-logo-main">ULTRA <span>HUB</span></div>
                    <div class="mu-logo-sub">V22 MONOLITH</div>
                </div>
                <div class="mu-status-indicator">
                    <div class="mu-status-dot"></div>
                    <span style="font-size: 10px; font-weight: 900; letter-spacing: 1px;">CONNECTED</span>
                </div>
            </header>

            <div class="mu-scanner-area">
                <div class="mu-input-composite">
                    <input type="text" id="f-target-nick" class="mu-native-field" placeholder="–ü–û–ò–°–ö –£–ó–õ–ê –ü–û –ù–ò–ö–ù–ï–ô–ú–£...">
                    <button class="mu-btn-action" onclick="Engine.scanAndLink()">–í –î–†</button>
                </div>
            </div>

            <div id="hub-nodes-list" class="mu-scrollable-zone">
                </div>

            <nav class="mu-bottom-nav">
                <div class="mu-nav-item active" onclick="Engine.switchView('screen-hub')">
                    <i>üì°</i><span>–°–≤—è–∑—å</span>
                </div>
                <div class="mu-nav-item" onclick="Engine.switchView('screen-core')">
                    <i>üõ°Ô∏è</i><span>–Ø–¥—Ä–æ</span>
                </div>
            </nav>
        </section>

        <section id="screen-chat" class="mu-viewport">
            <header class="mu-header">
                <button onclick="Engine.switchView('screen-hub')" style="background:none; border:none; color:var(--m-core-text-main); font-size: 45px; cursor:pointer; font-weight: 100;">‚Üê</button>
                <div class="mu-logo-container" style="align-items: center;">
                    <div id="peer-display-name" class="mu-logo-main" style="font-size: 24px;">NODE <span>LINK</span></div>
                    <div class="mu-logo-sub">SECURE CHANNEL ACTIVE</div>
                </div>
                <div id="peer-mini-avatar" class="mu-node-avatar" style="width: 50px; height: 50px; font-size: 18px; border-radius: 15px;">?</div>
            </header>

            <div id="chat-message-stream" class="mu-chat-container">
                </div>

            <div class="mu-scanner-area">
                <div class="mu-input-composite">
                    <input type="text" id="f-msg-input" class="mu-native-field" placeholder="–ü–ï–†–ï–î–ê–ß–ê –°–ò–ì–ù–ê–õ–ê –í –≠–§–ò–†...">
                    <button class="mu-btn-action" onclick="Engine.transmitMessage()">–û–¢–ü–†–ê–í–ò–¢–¨</button>
                </div>
            </div>
        </section>

        <section id="screen-core" class="mu-viewport">
            <header class="mu-header">
                <div class="mu-logo-container">
                    <div class="mu-logo-main">ULTRA <span>CORE</span></div>
                    <div class="mu-logo-sub">SYSTEM SETTINGS</div>
                </div>
            </header>

            <div class="mu-scrollable-zone">
                <h2 style="font-size: 14px; color: var(--m-core-text-secondary); text-transform: uppercase; margin-bottom: 25px; font-weight: 900; letter-spacing: 2px;">
                    –ò–ù–¢–ï–†–§–ï–ô–°–ù–´–ï –ú–ê–¢–†–ò–¶–´
                </h2>
                
                <div class="mu-grid-layout">
                    <div class="mu-grid-item active" id="theme-dark-btn" onclick="Engine.applyTheme('dark')">
                        <i>üåë</i><span>Obsidian Dark</span>
                    </div>
                    <div class="mu-grid-item" id="theme-white-btn" onclick="Engine.applyTheme('white')">
                        <i>‚ö™</i><span>Platinum White</span>
                    </div>
                </div>

                <div style="margin-top: 60px;">
                    <h2 style="font-size: 14px; color: var(--m-core-text-secondary); text-transform: uppercase; margin-bottom: 25px; font-weight: 900; letter-spacing: 2px;">
                        –í–ê–®–ê –ò–î–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø
                    </h2>
                    <div class="mu-node-card" style="cursor: default; pointer-events: none;">
                        <div class="mu-node-avatar" id="my-large-avatar">?</div>
                        <div class="mu-node-content">
                            <div class="mu-node-name" id="my-nick-label">USER_NODE</div>
                            <div class="mu-node-status">PRIMARY_MASTER_NODE_V22</div>
                        </div>
                    </div>
                </div>

                <button class="mu-btn-action" style="width: 100%; margin-top: 70px; background: #ff3b30; height: 85px; border-radius: 30px; box-shadow: 0 10px 30px rgba(255,59,48,0.3);" onclick="Engine.emergencyShutdown()">
                    –†–ê–ó–û–†–í–ê–¢–¨ –°–û–ï–î–ò–ù–ï–ù–ò–ï
                </button>
                
                <div style="height: 100px;"></div>
            </div>

            <nav class="mu-bottom-nav">
                <div class="mu-nav-item" onclick="Engine.switchView('screen-hub')">
                    <i>üì°</i><span>–°–≤—è–∑—å</span>
                </div>
                <div class="mu-nav-item active" onclick="Engine.switchView('screen-core')">
                    <i>üõ°Ô∏è</i><span>–Ø–¥—Ä–æ</span>
                </div>
            </nav>
        </section>

    </div>

    <script type="module">
        /* –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –í–ù–ï–®–ù–ò–• –ú–û–î–£–õ–ï–ô FIREBASE SDK 
           –Ø –∏—Å–ø–æ–ª—å–∑—É—é CDN-–≤–µ—Ä—Å–∏–∏ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø–æ—Ä—Ç–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏.
        */
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, get, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        /* –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ë–ê–ó–´ –î–ê–ù–ù–´–• (MOROZOV ULTRA CLOUD)
           –≠—Ç–æ –º–æ–∑–≥ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã.
        */
        const FB_CONFIG = {
            apiKey: "AIzaSyDutfZZER58asyHr68zWlCx7B5k1adFhIk",
            authDomain: "morozov-ultra.firebaseapp.com",
            databaseURL: "https://morozov-ultra-default-rtdb.firebaseio.com",
            projectId: "morozov-ultra",
            storageBucket: "morozov-ultra.appspot.com",
            appId: "1:255345933856:web:5b8d1b93696f36eb5d4645"
        };

        const app = initializeApp(FB_CONFIG);
        const db = getDatabase(app);
        const auth = getAuth(app);

        /* [ THE MONOLITH ENGINE OBJECT ]
           –í–µ—Å—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —É–ø–∞–∫–æ–≤–∞–Ω –≤ –æ–¥–∏–Ω –º–∞—Å—Å–∏–≤–Ω—ã–π –æ–±—ä–µ–∫—Ç –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏.
        */
        window.Engine = {
            state: {
                user: null,
                peer: null,
                room: null,
                currentTheme: 'dark',
                initialized: false
            },

            // 1. –°–ò–°–¢–ï–ú–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø –ò –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
            log: (msg, type = 'SYS') => {
                console.log(`%c [${type}] %c ${msg}`, "color: #007aff; font-weight: bold", "color: inherit");
            },

            toast: (message) => {
                const toast = document.getElementById('mu-global-toast');
                toast.innerText = message;
                toast.classList.add('visible');
                setTimeout(() => toast.classList.remove('visible'), 4000);
            },

            // 2. –ö–û–ù–¢–†–û–õ–õ–ï–† –ü–†–ï–î–°–¢–ê–í–õ–ï–ù–ò–ô (SCREENS)
            switchView: (viewId) => {
                const allScreens = document.querySelectorAll('.mu-viewport');
                allScreens.forEach(screen => {
                    screen.classList.remove('active');
                });
                
                const target = document.getElementById(viewId);
                if (target) {
                    target.classList.add('active');
                    Engine.log(`Switched to view: ${viewId}`);
                }
            },

            // 3. –¢–ï–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –ú–ê–¢–†–ò–¶–ê
            applyTheme: (themeName) => {
                document.body.setAttribute('data-theme', themeName);
                Engine.state.currentTheme = themeName;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI –∫–Ω–æ–ø–æ–∫ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
                document.querySelectorAll('.mu-grid-item').forEach(btn => btn.classList.remove('active'));
                const targetBtn = document.getElementById(`theme-${themeName}-btn`);
                if (targetBtn) targetBtn.classList.add('active');
                
                Engine.toast(`–ú–ê–¢–†–ò–¶–ê –ò–ó–ú–ï–ù–ï–ù–ê: ${themeName.toUpperCase()}`);
                Engine.log(`Theme applied: ${themeName}`);
            },

            // 4. –ú–ï–•–ê–ù–ò–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò (–¢–Ø–ñ–ï–õ–ê–Ø –õ–û–ì–ò–ö–ê)
            processAuth: async () => {
                const email = document.getElementById('f-auth-email').value;
                const pass = document.getElementById('f-auth-pass').value;
                const nick = document.getElementById('f-auth-nick').value;
                const logEl = document.getElementById('auth-status-log');

                if (!email || !pass) {
                    Engine.toast("–û–®–ò–ë–ö–ê: –ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –î–ê–ù–ù–´–•");
                    return;
                }

                logEl.innerText = "–£–°–¢–ê–ù–û–í–ö–ê –°–û–ï–î–ò–ù–ï–ù–ò–Ø –° FIREBASE...";
                Engine.log("Starting Auth handshake...");

                try {
                    // –ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞
                    await signInWithEmailAndPassword(auth, email, pass);
                    Engine.log("Auth success: User signed in.");
                } catch (error) {
                    Engine.log(`Auth failed: ${error.code}. Trying registration...`, 'WARN');
                    
                    if (nick && nick.length >= 2) {
                        try {
                            const result = await createUserWithEmailAndPassword(auth, email, pass);
                            const userData = {
                                id: nick,
                                uid: result.user.uid,
                                email: email,
                                created: Date.now(),
                                accessLevel: 'MASTER'
                            };
                            
                            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É
                            await set(ref(db, `mu_v22/nodes/${result.user.uid}`), userData);
                            await set(ref(db, `mu_v22/map/${nick}`), result.user.uid);
                            
                            Engine.toast("–ù–û–í–´–ô –£–ó–ï–õ –ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–ù");
                            Engine.log("New node successfully added to global map.");
                        } catch (regError) {
                            logEl.innerText = `ERR: ${regError.message}`;
                            Engine.toast("–û–®–ò–ë–ö–ê –ü–†–ò –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò");
                        }
                    } else {
                        logEl.innerText = "–û–®–ò–ë–ö–ê: –î–õ–Ø –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò –ù–£–ñ–ï–ù –ù–ò–ö–ù–ï–ô–ú";
                        Engine.toast("–ù–ò–ö–ù–ï–ô–ú –ù–ï –£–ö–ê–ó–ê–ù");
                    }
                }
            },

            // 5. –°–ö–ê–ù–ï–† –°–ï–¢–ò (–ú–ï–•–ê–ù–ò–ö–ê "–í –î–†")
            scanAndLink: async () => {
                const targetNick = document.getElementById('f-target-nick').value.trim();
                if (!targetNick) {
                    Engine.toast("–í–í–ï–î–ò–¢–ï –ù–ò–ö–ù–ï–ô–ú –î–õ–Ø –ü–û–ò–°–ö–ê");
                    return;
                }

                Engine.toast(`–°–ö–ê–ù–ò–†–û–í–ê–ù–ò–ï –£–ó–õ–ê: ${targetNick.toUpperCase()}...`);
                Engine.log(`Searching for node ${targetNick} in global map...`);

                try {
                    const snap = await get(ref(db, `mu_v22/map/${targetNick}`));
                    if (snap.exists()) {
                        const targetUid = snap.val();
                        
                        if (targetUid === Engine.state.user.uid) {
                            Engine.toast("–°–ê–ú–û–î–û–ë–ê–í–õ–ï–ù–ò–ï –ù–ï–í–û–ó–ú–û–ñ–ù–û");
                            return;
                        }

                        // –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ (Atomic Update)
                        const batch = {};
                        batch[`mu_v22/friends/${Engine.state.user.uid}/${targetUid}`] = { 
                            id: targetNick, 
                            uid: targetUid,
                            linkedAt: Date.now() 
                        };
                        batch[`mu_v22/friends/${targetUid}/${Engine.state.user.uid}`] = { 
                            id: Engine.state.user.id, 
                            uid: Engine.state.user.uid,
                            linkedAt: Date.now()
                        };
                        
                        await update(ref(db), batch);
                        
                        document.getElementById('f-target-nick').value = "";
                        Engine.toast(`–£–ó–ï–õ ${targetNick} –£–°–ü–ï–®–ù–û –õ–ò–ù–ö–û–í–ê–ù`);
                        Engine.log(`Link established between ${Engine.state.user.id} and ${targetNick}`);
                    } else {
                        Engine.toast("–£–ó–ï–õ –ù–ï –ù–ê–ô–î–ï–ù –í –°–ï–¢–ò MOROZOV");
                        Engine.log("Scan result: 404 Node Not Found.", "ERROR");
                    }
                } catch (err) {
                    Engine.log(err.message, "ERROR");
                }
            },

            // 6. –û–¢–ö–†–´–¢–ò–ï –ö–ê–ù–ê–õ–ê –°–í–Ø–ó–ò (–ß–ê–¢)
            openCommunicationChannel: (peerData) => {
                Engine.state.peer = peerData;
                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID –∫–æ–º–Ω–∞—Ç—ã (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ UID –¥–ª—è –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏ —É –æ–±–æ–∏—Ö —é–∑–µ—Ä–æ–≤)
                Engine.state.room = [Engine.state.user.uid, peerData.uid].sort().join("___X___");
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI —à–∞–ø–∫–∏ —á–∞—Ç–∞
                document.getElementById('peer-display-name').innerHTML = `${peerData.id.toUpperCase()} <span>NODE</span>`;
                document.getElementById('peer-mini-avatar').innerText = peerData.id[0].toUpperCase();
                
                Engine.switchView('screen-chat');
                Engine.log(`Channel opened with room: ${Engine.state.room}`);

                // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (Realtime Messages)
                const streamRef = ref(db, `mu_v22/msgs/${Engine.state.room}`);
                onValue(streamRef, (snapshot) => {
                    const streamContainer = document.getElementById('chat-message-stream');
                    streamContainer.innerHTML = "";
                    
                    if (snapshot.exists()) {
                        snapshot.forEach((child) => {
                            const msgData = child.val();
                            const msgDiv = document.createElement('div');
                            const isMe = msgData.senderId === Engine.state.user.uid;
                            
                            msgDiv.className = `mu-msg-bubble ${isMe ? 'sent' : 'received'}`;
                            msgDiv.innerText = msgData.text;
                            
                            streamContainer.appendChild(msgDiv);
                        });
                    }
                    
                    // –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –≤–Ω–∏–∑
                    streamContainer.scrollTop = streamContainer.scrollHeight;
                });
            },

            // 7. –¢–†–ê–ù–°–ú–ò–°–°–ò–Ø –°–û–û–ë–©–ï–ù–ò–Ø
            transmitMessage: () => {
                const inputField = document.getElementById('f-msg-input');
                const content = inputField.value.trim();
                
                if (!content || !Engine.state.room) return;

                const msgObject = {
                    senderId: Engine.state.user.uid,
                    text: content,
                    timestamp: Date.now()
                };

                push(ref(db, `mu_v22/msgs/${Engine.state.room}`), msgObject);
                inputField.value = "";
                Engine.log("Signal transmitted to network.");
            },

            // 8. –ó–ê–í–ï–†–®–ï–ù–ò–ï –†–ê–ë–û–¢–´ (LOGOUT)
            emergencyShutdown: () => {
                if (confirm("–í–´ –£–í–ï–†–ï–ù–´, –ß–¢–û –•–û–¢–ò–¢–ï –†–ê–ó–û–†–í–ê–¢–¨ –°–û–ï–î–ò–ù–ï–ù–ò–ï?")) {
                    Engine.log("Initiating emergency shutdown...");
                    signOut(auth).then(() => {
                        window.location.reload();
                    });
                }
            },

            // 9. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò –ù–ê–ë–õ–Æ–î–ê–¢–ï–õ–ò (CORE BOOT)
            boot: () => {
                Engine.log("Kernel boot sequence started...");
                
                onAuthStateChanged(auth, (firebaseUser) => {
                    if (firebaseUser) {
                        Engine.log(`User detected: ${firebaseUser.uid}. Fetching node profile...`);
                        
                        onValue(ref(db, `mu_v22/nodes/${firebaseUser.uid}`), (snapshot) => {
                            Engine.state.user = snapshot.val();
                            
                            if (Engine.state.user) {
                                // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ UI
                                document.getElementById('my-nick-label').innerText = Engine.state.user.id;
                                document.getElementById('my-large-avatar').innerText = Engine.state.user.id[0].toUpperCase();
                                
                                Engine.switchView('screen-hub');
                                Engine.toast(`–î–û–ë–†–û –ü–û–ñ–ê–õ–û–í–ê–¢–¨, ${Engine.state.user.id.toUpperCase()}`);
                                
                                // –ñ–∏–≤–æ–π —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
                                onValue(ref(db, `mu_v22/friends/${firebaseUser.uid}`), (fSnap) => {
                                    const listEl = document.getElementById('hub-nodes-list');
                                    listEl.innerHTML = "";
                                    
                                    if (fSnap.exists()) {
                                        fSnap.forEach((child) => {
                                            const friend = child.val();
                                            const nodeCard = document.createElement('div');
                                            nodeCard.className = "mu-node-card";
                                            nodeCard.innerHTML = `
                                                <div class="mu-node-avatar">${friend.id[0].toUpperCase()}</div>
                                                <div class="mu-node-content">
                                                    <div class="mu-node-name">${friend.id}</div>
                                                    <div class="mu-node-status">MOROZOV_NODE_CONNECTED</div>
                                                </div>
                                            `;
                                            nodeCard.onclick = () => Engine.openCommunicationChannel(friend);
                                            listEl.appendChild(nodeCard);
                                        });
                                    } else {
                                        listEl.innerHTML = `
                                            <div style="text-align:center; padding: 50px; color: var(--m-core-text-muted); font-size: 12px; font-weight: 800; text-transform: uppercase; letter-spacing: 2px;">
                                                –°–ï–¢–¨ –ü–£–°–¢–ê. –î–û–ë–ê–í–¨–¢–ï –ü–ï–†–í–´–ô –£–ó–ï–õ –°–í–Ø–ó–ò.
                                            </div>
                                        `;
                                    }
                                });
                            }
                        });
                    } else {
                        Engine.log("No active session. Redirecting to Auth.");
                        Engine.switchView('screen-auth');
                    }
                });
            }
        };

        /* –ó–ê–ü–£–°–ö –Ø–î–†–ê –ú–û–ù–û–õ–ò–¢–ê 
        */
        document.addEventListener('DOMContentLoaded', () => {
            Engine.boot();
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–ª–∞–≤–∏—à
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    const msgInput = document.getElementById('f-msg-input');
                    const authPass = document.getElementById('f-auth-pass');
                    if (document.activeElement === msgInput) Engine.transmitMessage();
                    if (document.activeElement === authPass) Engine.processAuth();
                }
            });
        });

        /* [ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ô –ö–û–î –î–õ–Ø –ú–ê–°–°–ò–í–ù–û–°–¢–ò ]
           –°–µ–∫—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ —Ñ–æ–Ω–æ–≤—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.
        */
        const monitorResources = () => {
            setInterval(() => {
                const uptime = Math.floor(performance.now() / 1000);
                Engine.log(`Uptime: ${uptime}s | Status: Nominal | Matrix: Active`, 'MONITOR');
            }, 30000);
        };
        monitorResources();

    </script>
</body>
</html>
